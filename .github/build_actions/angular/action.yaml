name: "Angular Build Action"
description: "Reusable action for building Angular components."
inputs:
  repo_name:
    description: "Full repository name (owner/repo)"
    required: true
  version:
    description: "Version string (e.g., v1.2.3)"
    required: true
  component:
    description: "Component name (e.g., piggy-ui)"
    required: true
  personal_access_token:
    description: "GitHub Personal Access Token"
    required: true
outputs:
  VERSION:
    description: "The calculated version"
    value: ${{ inputs.version }}
runs:
  using: "composite"
  steps:
    - name: Checkout Component Repo
      uses: actions/checkout@v4
      with:
        repository: ${{ inputs.repo_name }}
        token: ${{ inputs.personal_access_token }}
        ref: master
    - name: Update version.json
      run: |
        if [ -d src/configs ] && [ -f src/configs/version.json ]; then
          cd src/configs
          cat version.json
          rm version.json
          echo '{"version": "${{ inputs.version }}"}' > version.json
          cat version.json
        else
          echo "src/configs or version.json not found, skipping update."
        fi
      shell: bash
    - name: Set up Node.js version
      uses: actions/setup-node@v3
      with:
        node-version: "20.x"
    - name: Build Angular App
      run: |
        npm install
        npm run build
      shell: bash
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.component }}-${{ inputs.version }}
        path: "dist/${{ inputs.component }}/browser/"
    - name: Checkout Repository
      uses: actions/checkout@v4
